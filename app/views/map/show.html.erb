<!-- app/views/map/show.html.erb -->
<div data-controller="geolocation" data-action="geolocation#search">
  <%# <button data-action="geolocation#search">Find me</button> %>
</div>
<div id="map" style="height: 700px; width: 100%;"></div>

<script>
  function initMap() {
    var latitude = parseFloat(document.getElementById('lat').innerHTML);
    var longitude = parseFloat(document.getElementById('long').innerHTML);

    var map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: latitude, lng: longitude},
      zoom: 15
    });

    var marker = new google.maps.Marker({
      position: {lat: latitude, lng: longitude},
      map: map,
      title: 'Your Location',
      icon: {
        url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png"
      }
    });

    // Array of art pieces
    var artPieces = <%= @art_pieces.to_json.html_safe %>;

    artPieces.forEach(function(artPiece) {
      new google.maps.Marker({
        position: {lat: artPiece.latitude, lng: artPiece.longitude},
        map: map,
        title: artPiece.name,
        icon: {
          url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        }
      });
    });
  }

  navigator.geolocation.getCurrentPosition(function(position) {
    document.getElementById('lat').textContent = position.coords.latitude;
    document.getElementById('long').textContent = position.coords.longitude;
    document.getElementById('acc').textContent = position.coords.accuracy;

    // Call the initMap function after getting the geolocation data
    initMap();
  });
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEzQSINw3YNC7yj7sxOiHcks8FKYXcwk0&callback=initMap"></script>
<p style=opacity:0;”>Your Latitude   : <span id="lat"><%= @latitude %></span> </p>
<p style=opacity:0;”>Your Longitude  : <span id="long"><%= @longitude %></span> </p>
<p style=opacity:0;”>Accuracy in 'm' : <span id="acc"> 0 </span>